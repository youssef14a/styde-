<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>جدول المذاكرة</title>
  <style>
    body {
      font-family: 'Tajawal', sans-serif;
      background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
      margin: 0;
      padding: 20px;
      overflow-x: hidden;
      position: relative;
    }
    h1 {
      text-align: center;
      color: #333;
      font-size: 3rem;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
      animation: fadeInDown 1.5s ease-in-out;
    }
    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 20px;
    }
    .month-section {
      margin-bottom: 40px;
      width: 100%;
      max-width: 800px; /* تحديد عرض الجدول */
      animation: slideIn 1s ease-in-out;
    }
    .month-title {
      text-align: center;
      font-size: 2rem;
      color: #4CAF50;
      margin-bottom: 20px;
      font-weight: bold;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      border-radius: 8px;
      overflow: hidden;
      animation: fadeIn 1s ease-in-out;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: center;
      transition: background-color 0.3s ease;
    }
    th {
      background-color: #4CAF50;
      color: white;
      font-weight: bold;
      font-size: 1.1rem;
    }
    tr.completed-row td {
      background-color: #d4edda;
      color: #155724;
    }
    td button {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.3s ease;
      font-size: 1rem;
    }
    td button.start-btn {
      background-color: #007bff;
      color: white;
    }
    td button.end-btn {
      background-color: #28a745;
      color: white;
    }
    td button:hover {
      transform: scale(1.1);
    }
    .floating-total-hours {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: #fff;
      padding: 15px 20px;
      border-radius: 50px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      font-size: 1.2rem;
      font-weight: bold;
      color: #333;
      z-index: 1000;
      animation: floatUp 2s ease-in-out infinite alternate;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeInDown {
      from { opacity: 0; transform: translateY(-50px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-50px); }
      to { opacity: 1; transform: translateX(0); }
    }
    @keyframes floatUp {
      from { transform: translateY(0); }
      to { transform: translateY(-10px); }
    }
  </style>
</head>
<body>
  <h1>جدول المذاكرة لمدة 90 يومًا</h1>
  <div class="floating-total-hours" id="floatingTotalHours">إجمالي الساعات: 0 / 225 (0%)</div>
  <div class="container">
    <!-- سيتم تعبئة الأقسام بواسطة JavaScript -->
  </div>

  <script>
    const container = document.querySelector('.container');
    const floatingTotalHoursElement = document.getElementById('floatingTotalHours');
    let totalHoursCompleted = 0;

    // تحميل البيانات من localStorage إذا كانت موجودة
    const savedData = JSON.parse(localStorage.getItem('studySchedule')) || {
      totalHoursCompleted: 0,
      days: []
    };

    totalHoursCompleted = savedData.totalHoursCompleted;

    function createStudySchedule() {
      const months = [
        { name: 'الشهر الأول', hoursPerDay: 1.5 },
        { name: 'الشهر الثاني', hoursPerDay: 2.5 },
        { name: 'الشهر الثالث', hoursPerDay: 3.5 }
      ];

      // تاريخ البداية
      const startDate = new Date(2025, 1, 4); // 4 فبراير 2025

      months.forEach((month, monthIndex) => {
        const monthSection = document.createElement('div');
        monthSection.className = 'month-section';

        const monthTitle = document.createElement('h2');
        monthTitle.textContent = month.name;
        monthTitle.className = 'month-title';
        monthSection.appendChild(monthTitle);

        const table = document.createElement('table');
        const thead = document.createElement('thead');
        const tbody = document.createElement('tbody');

        const headerRow = document.createElement('tr');
        ['اليوم', 'التاريخ', 'الوقت', 'عدد الساعات', 'الإجراءات'].forEach(headerText => {
          const th = document.createElement('th');
          th.textContent = headerText;
          headerRow.appendChild(th);
        });
        thead.appendChild(headerRow);

        for (let i = 1; i <= 30; i++) {
          const dayCounter = monthIndex * 30 + i;
          const row = document.createElement('tr');

          // استعادة حالة اليوم من localStorage
          const savedDay = savedData.days.find(d => d.day === dayCounter) || {};
          const elapsedTime = savedDay.elapsedTime || 0;
          const isCompleted = savedDay.status === 'completed';
          const startTime = savedDay.startTime;

          // حساب التاريخ لكل يوم
          const currentDate = new Date(startDate);
          currentDate.setDate(startDate.getDate() + dayCounter - 1);

          const formattedDate = `${currentDate.getDate()} ${getMonthName(currentDate.getMonth())} ${currentDate.getFullYear()}`;
          const formattedTime = elapsedTimeToTime(elapsedTime, month.hoursPerDay);

          const dayCell = document.createElement('td');
          dayCell.textContent = `اليوم ${dayCounter}`;
          row.appendChild(dayCell);

          const dateCell = document.createElement('td');
          dateCell.textContent = formattedDate;
          row.appendChild(dateCell);

          const timeCell = document.createElement('td');
          timeCell.textContent = formattedTime;
          row.appendChild(timeCell);

          const hoursCell = document.createElement('td');
          hoursCell.textContent = month.hoursPerDay + ' ساعة';
          row.appendChild(hoursCell);

          const actionsCell = document.createElement('td');
          const startButton = document.createElement('button');
          startButton.textContent = 'ابدأ';
          startButton.className = 'start-btn';

          const endButton = document.createElement('button');
          endButton.textContent = isCompleted ? 'You Did It!' : 'Do It';
          endButton.className = 'end-btn';
          endButton.style.display = isCompleted ? 'inline-block' : 'none';

          if (isCompleted) {
            row.classList.add('completed-row');
            row.style.backgroundColor = '#d4edda';
          }

          let intervalId = null;

          // قائمة بألوان متعددة لمحاكاة المبة الملونة
          const colors = ['#FF5733', '#33FF57', '#3357FF', '#F3FF33', '#FF33F3'];
          let colorIndex = 0;

          // استئناف العد إذا كان قد بدأ بالفعل
          if (startTime && !isCompleted) {
            const currentTime = Date.now();
            const elapsedMilliseconds = currentTime - startTime;
            const newElapsedTime = Math.floor(elapsedMilliseconds / 1000) + elapsedTime;

            if (newElapsedTime < month.hoursPerDay * 3600) {
              savedDay.elapsedTime = newElapsedTime;
              savedDay.startTime = currentTime;
              saveData();

              intervalId = setInterval(() => updateTimer(row, timeCell, savedDay, month, endButton), 1000);
              startButton.style.display = 'none';
              endButton.style.display = 'inline-block';
            } else {
              savedDay.elapsedTime = month.hoursPerDay * 3600;
              savedDay.status = 'completed';
              totalHoursCompleted += month.hoursPerDay;
              updateTotalHours();
              saveData();

              row.classList.add('completed-row');
              row.style.backgroundColor = '#d4edda';
              timeCell.textContent = `${month.hoursPerDay.toFixed(1)} ساعة`;
              startButton.style.display = 'none';
              endButton.textContent = 'You Did It!';
              endButton.style.display = 'inline-block';
            }
          }

          startButton.addEventListener('click', () => {
            if (!intervalId) {
              savedDay.startTime = Date.now();
              savedDay.elapsedTime = savedDay.elapsedTime || 0;
              saveData();

              intervalId = setInterval(() => updateTimer(row, timeCell, savedDay, month, endButton), 1000);
              startButton.style.display = 'none';
              endButton.style.display = 'inline-block';
            }
          });

          actionsCell.appendChild(startButton);
          actionsCell.appendChild(endButton);
          row.appendChild(actionsCell);

          tbody.appendChild(row);
        }

        table.appendChild(thead);
        table.appendChild(tbody);
        monthSection.appendChild(table);
        container.appendChild(monthSection);
      });

      updateTotalHours();
    }

    function updateTimer(row, timeCell, savedDay, month, endButton) {
      const currentTime = Date.now();
      const elapsedMilliseconds = currentTime - savedDay.startTime;
      savedDay.elapsedTime = Math.floor(elapsedMilliseconds / 1000) + (savedDay.elapsedTime || 0);

      const hours = Math.floor(savedDay.elapsedTime / 3600);
      const minutes = Math.floor((savedDay.elapsedTime % 3600) / 60);
      const seconds = savedDay.elapsedTime % 60;
      timeCell.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;

      // تغيير لون الصف بشكل ديناميكي باستخدام ألوان مختلفة
      row.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];

      if (savedDay.elapsedTime >= month.hoursPerDay * 3600) {
        clearInterval(intervalId);
        savedDay.elapsedTime = month.hoursPerDay * 3600;
        savedDay.status = 'completed';
        totalHoursCompleted += month.hoursPerDay;
        updateTotalHours();
        saveData();

        row.classList.add('completed-row');
        row.style.backgroundColor = '#d4edda';
        timeCell.textContent = `${month.hoursPerDay.toFixed(1)} ساعة`;
        endButton.textContent = 'You Did It!';
        endButton.style.backgroundColor = '#28a745';
      }
    }

    function getMonthName(monthIndex) {
      const months = [
        'يناير', 'فبراير', 'مارس', 'أبريل', 'مايو', 'يونيو',
        'يوليو', 'أغسطس', 'سبتمبر', 'أكتوبر', 'نوفمبر', 'ديسمبر'
      ];
      return months[monthIndex];
    }

    function elapsedTimeToTime(elapsedTime, hoursPerDay) {
      if (elapsedTime >= hoursPerDay * 3600) {
        return `${hoursPerDay.toFixed(1)} ساعة`;
      }
      const hours = Math.floor(elapsedTime / 3600);
      const minutes = Math.floor((elapsedTime % 3600) / 60);
      const seconds = elapsedTime % 60;
      return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }

    function updateTotalHours() {
      const percentage = ((totalHoursCompleted / 225) * 100).toFixed(1);
      floatingTotalHoursElement.textContent = `إجمالي الساعات: ${totalHoursCompleted.toFixed(1)} / 225 (${percentage}%)`;
    }

    function saveData() {
      savedData.totalHoursCompleted = totalHoursCompleted;
      localStorage.setItem('studySchedule', JSON.stringify(savedData));
    }

    // تهيئة الجدول وتحديث إجمالي الساعات
    createStudySchedule();
  </script>
</body>
</html>